# 游戏动画系统说明

本文档详细说明了游戏中实现的各种动画效果及其触发时机。

## 动画系统架构

动画系统基于 `Animation` 基类实现，所有动画都继承自该基类并实现以下方法：
- `update()`: 更新动画状态
- `draw(screen)`: 绘制动画帧
- `is_finished()`: 检查动画是否完成

动画文件位置: `src/objects/animation.py`

## 已实现的动画效果

### 1. 开场欢迎动画 (WelcomeAnimation)

**触发时机**: 游戏启动时自动播放

**动画效果**:
- 动态星空背景（50个星星从上往下移动）
- 标题文字淡入淡出效果
  - 主标题: "打飞机游戏" (金色，大字体)
  - 副标题: "准备战斗！" (白色)
- 闪烁提示文字: "按任意键开始..."
- 持续时间: 3秒 (180帧)

**交互方式**: 
- 按任意键可跳过动画，立即开始游戏

**实现细节**:
```python
# 星空背景粒子系统
# 标题alpha透明度渐变
# 闪烁效果通过帧数取模实现
```

---

### 2. 关卡介绍动画 (LevelIntroAnimation)

**触发时机**: 
- 每关开始前自动播放
- 第一关在开场动画后播放
- 后续关卡在上一关完成动画后播放

**动画效果**:
- 半透明黑色遮罩背景
- 装饰粒子雨效果（30个彩色粒子从上往下掉落）
- 关卡标题缩放动画
  - 显示: "第 X 关" (金色大字，从小到大缩放)
- 游戏信息显示:
  - 当前分数
  - 关卡特定提示（每关不同）
    - 第1关: "消灭 100 个敌人召唤Boss！"
    - 第2关: "敌人更强了，小心应对！"
    - 第3关: "最终关卡，全力以赴！"
- 持续时间: 2秒 (120帧)

**实现细节**:
```python
# 粒子颜色: 金色、白色、青色随机
# 缩放效果: scale = min(1.0, timer / 30)
```

---

### 3. 关卡完成动画 (LevelCompleteAnimation)

**触发时机**: 
- Boss被击败后，Boss胜利动画播放完毕
- 仅在前两关（第1、2关）播放

**动画效果**:
- 半透明深色遮罩
- 多个烟花依次爆炸（5个烟花，不同延迟）
- 每个烟花包含:
  - 上升火焰阶段
  - 爆炸粒子（30个）
  - 粒子带重力效果下落
  - 6种彩色粒子：红、绿、蓝、黄、紫、青
- 关卡统计信息:
  - 标题: "关卡完成！" (金色)
  - 当前关卡号
  - 总分数
  - 击杀数量
- 提示文字: "准备进入下一关..."
- 持续时间: 3秒 (180帧)

**实现细节**:
```python
# 烟花爆炸粒子数: 30
# 粒子生命周期: 60帧
# 重力加速度: 0.2
```

---

### 4. Boss战胜利动画 (BossVictoryAnimation)

**触发时机**: 
- 每关Boss被击败后立即播放
- 是击败Boss后首先看到的动画

**动画效果**:
- 深蓝色半透明背景
- 100个闪烁星星（alpha值在100-255之间脉动）
- 8个大型烟花依次爆炸（延迟间隔15帧）
- 超强烟花效果:
  - 每个烟花50个粒子
  - 粒子带光晕效果（2层光晕）
  - 粒子大小随生命值衰减
  - 8种彩色随机组合
  - 带空气阻力效果（0.98衰减系数）
- 胜利文字:
  - 主标题: "Boss 击败！" (金色，脉冲缩放效果)
  - 副标题: "恭喜胜利！" (白色)
  - 文字带发光效果（5层外发光）
- 持续时间: 2.5秒 (150帧)

**实现细节**:
```python
# 脉冲效果: abs(sin(timer/10)) * 20 + 60
# 光晕层数: 5层，透明度递减
# 粒子重力: 0.15
# 空气阻力: 0.98
```

---

### 5. 游戏通关动画 (GameCompleteAnimation)

**触发时机**: 
- 完成第3关（最后一关）Boss战后播放
- 仅在通关时播放一次

**动画效果**:
- 深色半透明背景
- 持续生成的烟花效果
  - 每20帧生成一个新烟花
  - 每个烟花40个粒子
  - 烟花持续整个动画周期
- 通关信息:
  - 主标题: "恭喜通关！" (金色，超大字体)
  - 最终得分显示
  - 感谢文字: "感谢游玩！" (青色)
- 持续时间: 4秒 (240帧)

**实现细节**:
```python
# 烟花生成间隔: 20帧
# 粒子数量: 40
# 粒子生命: 60帧
# 持续烟花效果贯穿整个动画
```

---

## 动画集成流程

### 游戏状态机

游戏通过状态机控制动画播放：

```
游戏启动 → 'welcome' (开场动画)
    ↓
  'level_intro' (第1关介绍)
    ↓
  'playing' (游戏进行中)
    ↓
  击败Boss
    ↓
  'boss_victory' (Boss胜利动画)
    ↓
  第1、2关 → 'level_complete' (关卡完成) → 下一关 'level_intro'
  第3关 → 'game_complete' (通关动画)
```

### 动画触发机制

1. **开场动画**: 在 `Game.__init__()` 中初始化
2. **关卡介绍**: 在 `GameScene._start_level_intro()` 中触发
3. **Boss胜利**: 在 `GameScene.update()` 中检测Boss死亡时触发
4. **关卡完成**: 在Boss胜利动画结束后触发
5. **游戏通关**: 在第3关Boss胜利动画结束后触发

### 游戏暂停机制

动画播放时，`game_paused = True`，暂停游戏逻辑更新：
- 玩家无法移动
- 敌人停止更新
- 子弹停止移动
- 仅更新和绘制动画

---

## 动画参数配置

### 可调整的参数

各动画的持续时间、粒子数量等参数可在动画类中调整：

| 动画类型 | 持续时间 | 粒子数 | 主要颜色 |
|---------|---------|--------|---------|
| WelcomeAnimation | 180帧(3秒) | 50 | 金色/白色 |
| LevelIntroAnimation | 120帧(2秒) | 30 | 金色/白色/青色 |
| LevelCompleteAnimation | 180帧(3秒) | 5烟花×30粒子 | 6色彩虹 |
| BossVictoryAnimation | 150帧(2.5秒) | 8烟花×50粒子 | 8色丰富 |
| GameCompleteAnimation | 240帧(4秒) | 持续生成 | 6色彩虹 |

---

## 视觉特效技术

### 1. 粒子系统
- 基于物理的粒子运动（速度、加速度）
- 生命周期管理
- 颜色和大小衰减

### 2. 透明度效果
- 淡入淡出 (alpha渐变)
- 脉冲效果 (sin波动)
- 闪烁效果 (帧数取模)

### 3. 缩放动画
- 从小到大的缩放
- 脉冲缩放

### 4. 光晕效果
- 多层绘制
- 透明度递减
- 位置偏移

### 5. 重力系统
- 粒子下落加速
- 空气阻力

---

## 未来扩展建议

1. **音效同步**: 为每个动画添加配套音效
2. **动画跳过**: 添加ESC键快速跳过所有动画
3. **动画速度**: 添加动画播放速度调节
4. **更多特效**: 
   - 屏幕震动效果
   - 慢动作效果
   - 光线追踪效果
5. **自定义动画**: 允许玩家选择动画风格

---

## 开发者笔记

### 性能优化
- 使用对象池管理粒子，避免频繁创建销毁
- 限制同屏粒子数量
- 及时清理完成的动画对象

### 已知问题
- 暂无

### 测试建议
- 测试每个动画的触发时机
- 验证动画结束后游戏状态正确切换
- 检查动画播放时游戏是否正确暂停

---

**文档版本**: 1.0  
**最后更新**: 2025-10-27  
**维护者**: 开发团队
