# 游戏新功能说明

## 已实现的新功能

### 1. 玩家死亡判定与游戏结束机制

当玩家生命值降为0时，游戏会触发以下流程：

- ✅ 自动检测玩家生命值状态
- ✅ 当生命值≤0时，触发游戏结束状态
- ✅ 播放专门的游戏结束动画（`GameOverAnimation`）
- ✅ 显示最终得分和达到的关卡

### 2. 游戏结束动画效果

新增 `GameOverAnimation` 类，提供丰富的视觉反馈：

- ✅ 暗色半透明背景
- ✅ 下落的灰色粒子效果
- ✅ "GAME OVER" 红色闪烁标题（脉冲效果）
- ✅ 显示最终得分和关卡进度
- ✅ 动画持续5秒，留出续命操作时间

### 3. 手动续命功能

玩家死亡后可通过按键恢复游戏：

- ✅ **按 R 键续命**：恢复3点生命值并继续游戏
- ✅ **按 ESC 键**：退出游戏
- ✅ 续命提示文字带有闪烁效果，方便玩家注意
- ✅ 续命后立即恢复游戏控制，敌人和子弹状态保持

### 4. 移除生命值上限限制

- ✅ 删除了 `max_hp` 属性
- ✅ 玩家生命值现在可以无限增长
- ✅ 更新了UI显示，只显示当前生命值 `HP: X`
- ✅ 新增 `add_hp()` 方法用于增加生命值

### 5. 关卡通关奖励生命值

- ✅ 每次成功击败Boss完成关卡后，自动奖励玩家+1生命值
- ✅ 奖励发生在关卡完成动画结束、进入下一关之前
- ✅ 控制台会打印生命值增加提示

## 操作说明

### 游戏结束时的选项：
- **单独按 R 键** - 续命（恢复3点生命值，立即恢复游戏）
  - **注意**：只需要按 R 键，不需要 CTRL+R 组合键
  - 续命后玩家能立即恢复移动控制
- **ESC 键** - 退出游戏

### 生命值显示：
- 左上角显示：`HP: X`（X为当前生命值，无上限）
- **已移除 max_hp 显示**，因为生命值可以无限增长

### 获得额外生命值的方式：
1. 完成关卡（击败Boss）：+1 HP
2. 续命操作：恢复到3点HP

### 重要提示：
- R键续命功能**仅在游戏结束界面（GAME OVER动画）时有效**
- 续命后会立即恢复到游戏进行中的状态
- 续命后玩家能立即使用方向键移动
- 敌人和子弹不会清空，续命后需要小心应对
- 可以无限次续命

### 玩家控制确认：
- **移动**：方向键（上下左右）
- **射击**：空格键（手动模式）或自动射击
- **切换武器**：1-5 数字键
- **切换射击模式**：A 键
- 续命后所有控制都会立即生效

## 技术实现细节

### 修改的文件：

1. **src/objects/player.py**
   - 移除 `max_hp` 属性
   - 新增 `add_hp(amount)` 方法

2. **src/objects/animation.py**
   - 新增 `GameOverAnimation` 类
   - 实现游戏结束的视觉效果

3. **src/scenes/game_scene.py**
   - 新增 `_start_game_over()` 方法
   - 修改 `handle_event()` 处理续命和退出
   - 修改 `update()` 添加死亡检测
   - 修改 `_handle_animation_complete()` 在通关时奖励生命值
   - 更新生命值显示UI

## 游戏流程

```
游戏开始
    ↓
正常游戏
    ↓
生命值 ≤ 0
    ↓
播放游戏结束动画
    ↓
玩家选择：
    ├─ 按R键 → 恢复3点HP → 继续游戏
    └─ 按ESC → 退出游戏
```

## 关卡奖励流程

```
击败Boss
    ↓
播放Boss胜利动画
    ↓
播放关卡完成动画
    ↓
奖励+1生命值  ← 新增
    ↓
进入下一关
```

## 注意事项

- 续命功能允许无限次使用（每次恢复3点HP）
- 生命值没有上限，可以无限累积
- 通关奖励仅在关卡完成时发放，死亡续命不会奖励
- 游戏结束动画会持续5秒后自动停止，但不会自动退出，需要玩家选择操作
